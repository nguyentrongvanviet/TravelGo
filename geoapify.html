<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Leaflet + OSRM Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <style>
        #map { height: 600px; }
        #info { margin: 10px; font-family: sans-serif; }
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="info">Click on two points to calculate driving distance.</div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Initialize map
        var map = L.map('map').setView([10.762622, 106.660172], 5);

        // Add OpenStreetMap tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);

        var points = [];
        var markers = [];
        var routeLine;

        function calculateRoute(start, end) {
            var url = `https://router.project-osrm.org/route/v1/driving/${start.lng},${start.lat};${end.lng},${end.lat}?overview=full&geometries=geojson`;
            console.log(url);
            fetch(url)
                .then(res => res.json())
                .then(data => {
                    if(data.routes && data.routes.length > 0) {
                        var route = data.routes[0];
                        var distance = (route.distance / 1000).toFixed(2); // km
                        var duration = (route.duration / 60).toFixed(1); // minutes
                        
                        document.getElementById('info').innerText = 
                            `Driving distance: ${distance} km, Duration: ${duration} min`;

                        // Remove old route line
                        if(routeLine) map.removeLayer(routeLine);

                        // Draw route line
                        routeLine = L.geoJSON(route.geometry, {
                            style: { color: 'blue', weight: 4 }
                        }).addTo(map);
                    }
                });
        }
        
        map.on('click', function(e) {
            if(points.length >= 2) {
                points = [];
                markers.forEach(m => map.removeLayer(m));
                markers = [];
                if(routeLine) map.removeLayer(routeLine);
            }

            points.push(e.latlng);
            var marker = L.marker(e.latlng).addTo(map);
            markers.push(marker);

            if(points.length === 2) {
                calculateRoute(points[0], points[1]);
            }
        });
    </script>
</body>
</html>
